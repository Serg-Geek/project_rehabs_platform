{% extends 'base.html' %}
{% load static %}

{% block title %}{{ story.title }} - История выздоровления{% endblock %}

{% block content %}
<section class="detail spec-detail rehab-help">
    <div class="container">
        <div class="detail__content rehab-help__content">
            <div class="detail__content-item detail__content-item--img rehab-help__content-item rehab-help__image">
                {% if story.image %}
                <img src="{{ story.image.url }}" alt="{{ story.title }}" />
                {% else %}
                <img src="{% static 'deps/img/notImage.svg' %}" alt="Нет изображения" />
                {% endif %}
            </div>
            <div class="detail__content-wrapper detail__content-item rehab-help__content-item">
                <h2 class="title__h2 detail__title">
                    {{ story.title }}
                </h2>
                <div class="detail__text spec-detail__text">
                    <p>{{ story.excerpt }}</p>
                    <div itemscope itemtype="https://schema.org/PostalAddress">
                        <span itemprop="addressRegion">{{ story.location }}</span>
                    </div>
                </div>
                {% if story.facility %}
                <div class="card">
                    <a href="{{ story.facility.get_absolute_url }}">
                        <div class="card__image">
                            {% if story.facility.images.first %}
                            <img src="{{ story.facility.images.first.image.url }}" alt="{{ story.facility.name }}" />
                            {% else %}
                            <img src="{% static 'deps/img/no-image.jpg' %}" alt="Нет изображения" />
                            {% endif %}
                        </div>
                        <div class="card__content">
                            <h3 class="card__title title__h4">
                                {{ story.facility.name }}
                            </h3>
                            <p class="card__description">
                                {{ story.facility.address }}
                            </p>
                            <div class="card__price">
                                <span class="card__price-value">
                                    {% if story.facility.content_type.model == 'rehabcenter' %}
                                    от {{ story.facility.program_duration }} дней
                                    {% elif story.facility.content_type.model == 'clinic' and
                                    story.facility.emergency_support %}
                                    Экстренная помощь
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<section class="detail__info rehab-detail__info">
    <div class="container">
        <div class="detail-content__wrapper">
            <h3 class="title__h3 detail__title">История выздоровления</h3>
            <div class="rehab-detail__text detail__text--width-limiter">
                {{ story.content|safe }}
            </div>
        </div>
    </div>
</section>

{% if related_stories %}
<section class="related-stories">
    <div class="container">
        <h3 class="title__h3">Похожие истории</h3>
        <div class="recovery-stories__grid">
            {% for story in related_stories %}
            <div class="recovery-story-card">
                <a href="{{ story.get_absolute_url }}" class="recovery-story-card__link">
                    <div class="recovery-story-card__image">
                        {% if story.image %}
                        <img src="{{ story.image.url }}" alt="{{ story.title }}" />
                        {% else %}
                        <img src="{% static 'deps/img/no-image.jpg' %}" alt="Нет изображения" />
                        {% endif %}
                    </div>
                    <div class="recovery-story-card__content">
                        <h3 class="recovery-story-card__title">{{ story.title }}</h3>
                        <p class="recovery-story-card__excerpt">{{ story.excerpt }}</p>
                        <div class="recovery-story-card__meta">
                            <span class="recovery-story-card__date">{{ story.published_at|date:"d.m.Y" }}</span>
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}
{% endblock %}