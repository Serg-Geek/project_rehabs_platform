# Руководство по работе с модулем управления заявками в админ-панели

## Содержание

1. Общая информация
2. Типы заявок
3. Работа с анонимными заявками
4. Работа с заявками от зависимых
5. Массовые действия
6. Шаблоны заявок
7. История статусов и логирование
8. Работа с заметками
9. Ответственные и приоритеты
10. Чеклист для новых сотрудников
11. Частые вопросы (FAQ)
12. Таблица переходов статусов

## 1. Общая информация

Модуль управления заявками позволяет операторам и администраторам работать с различными типами заявок от клиентов. Система поддерживает:

- Анонимные заявки (с сайта, по телефону, через партнеров)
- Заявки от зависимых лиц
- Отслеживание истории изменений статусов
- Логирование действий с заявками

## 2. Типы заявок

### Анонимные заявки (AnonymousRequest)

Основной тип заявок в системе, который предназначен для различных источников:

- Заявки с веб-формы консультации
- Заявки по телефону (внесенные оператором)
- Партнерские заявки
- Обращения по email

### Возможные статусы заявок

В системе для анонимных заявок и заявок от зависимых используется единый набор статусов:

- **Новая** (`new`)
- **В обработке** (`in_progress`)
- **Ожидание комиссии** (`waiting_commission`)
- **Комиссия получена** (`commission_received`)
- **Лечение начато** (`treatment_started`)
- **Лечение завершено** (`treatment_completed`)
- **Отменена** (`cancelled`)
- **Закрыта** (`closed`)

**Рекомендуемый порядок смены статусов:**

1. Новая → В обработке
2. В обработке → Ожидание комиссии (если требуется)
3. Ожидание комиссии → Комиссия получена (если требуется)
4. Комиссия получена → Лечение начато
5. Лечение начато → Лечение завершено
6. Лечение завершено → Закрыта

Вы можете пропускать этапы, если они не актуальны для конкретной заявки.

**История статусов и логи теперь работают одинаково для всех типов заявок.**

### Редактирование заявки

1. Откройте существующую заявку
2. Внесите необходимые изменения
3. По мере обработки заявки обновляйте её статус:
   - Новая → В обработке → Ожидание комиссии → Комиссия получена → Закрыта

### Управление комиссиями

Для партнерских заявок доступно управление комиссиями:

1. В разделе "Управление комиссией" укажите:
   - Сумму комиссии
   - Дату получения (устанавливается автоматически при смене статуса)
   - При необходимости прикрепите документ комиссии

## 4. Работа с заявками от зависимых

### Создание новой заявки от зависимого

1. Перейдите в раздел "Заявки от зависимых"
2. Нажмите "Добавить заявку от зависимого"
3. Заполните основную информацию:
   - Тип зависимости
   - Тип контакта (анонимно, псевдоним, реальное имя)
   - **Обязательно** укажите телефон для связи
4. В зависимости от типа контакта:
   - Для реального имени: заполните имя и фамилию
   - Для псевдонима: укажите псевдоним
   - Для анонимного: псевдоним заполнится автоматически как "Аноним"
5. Заполните информацию о зависимости и предпочтительном лечении
6. Нажмите "Сохранить"

## 5. Массовые действия

Система поддерживает массовые действия для эффективной обработки заявок любого типа (анонимных и от зависимых):

1. Выберите несколько заявок, отметив их флажками
2. В выпадающем меню "Действие" выберите нужное действие:
   - "Отметить как 'В обработке'" — для начала работы с заявками
   - "Отметить как 'Ожидание комиссии'" — если требуется ожидание оплаты/комиссии
   - "Отметить как 'Комиссия получена'" — для фиксации поступления комиссии
   - "Отметить как 'Лечение начато'" — для перехода к этапу лечения
   - "Отметить как 'Лечение завершено'" — для завершения лечения
   - "Отметить как 'Закрыто'" — для полного завершения работы
   - "Назначить мне" — чтобы назначить себя ответственным
   - "Установить высокий приоритет" — для срочных заявок

**Пример:**

- Выделите 5 заявок → выберите "Отметить как 'Лечение начато'" → все выбранные заявки перейдут в этот статус.

Все массовые действия автоматически логируются в истории статусов и действий.

## 6. Шаблоны заявок

Для упрощения работы с типовыми заявками можно использовать шаблоны:

1. Перейдите в раздел "Шаблоны заявок"
2. Создайте шаблон с типовым текстом для определенного типа заявок (например, для консультаций, лечения, реабилитации)
3. При создании новой заявки используйте шаблон, чтобы автоматически заполнить поля

**Примеры использования шаблонов:**

- Для повторяющихся сценариев (например, стандартная заявка на консультацию)
- Для разных типов зависимостей (алкоголь, наркотики и т.д.)
- Для партнерских заявок с фиксированными условиями

**Рекомендации:**

- Регулярно обновляйте шаблоны с учётом изменений бизнес-процессов
- Используйте шаблоны для ускорения ввода и снижения ошибок
- Не забывайте проверять и дополнять автоматически подставленные данные

## 7. История статусов и логирование

Система автоматически ведет журнал всех изменений:

### История статусов

- Каждое изменение статуса заявки сохраняется в истории
- Фиксируется старый и новый статус, дата и пользователь, внесший изменение
- История доступна в разделе заявки "История статусов"

### Логи действий

- Все действия с заявками (создание, обновление, изменение статуса) фиксируются в логах
- Логи содержат информацию о типе действия, пользователе и деталях
- Логи доступны только для чтения

## 8. Работа с заметками

Заметки позволяют фиксировать дополнительную информацию по заявке, важные детали, договорённости или комментарии коллег.

**Как добавить заметку:**

1. Откройте заявку
2. В разделе "Заметки" нажмите "Добавить заметку"
3. Введите текст заметки, при необходимости отметьте как важную
4. Сохраните

**Примеры использования:**

- Фиксация договорённостей с клиентом или родственниками
- Внутренние комментарии для коллег
- Важные уточнения по статусу или условиям

**Рекомендации:**

- Используйте важные заметки для критически важной информации
- Не удаляйте старые заметки — они помогают отслеживать историю работы по заявке
- При необходимости используйте фильтрацию по важности или автору заметки

## 9. Ответственные и приоритеты

**Назначение ответственного:**

- В каждой заявке можно выбрать пользователя, ответственного за обработку
- Используйте массовое действие "Назначить мне" для быстрого назначения
- Регулярно проверяйте, чтобы у всех активных заявок был назначен ответственный

**Установка приоритета:**

- Для каждой заявки можно выбрать приоритет: низкий, средний, высокий, срочный
- Используйте высокий или срочный приоритет для заявок, требующих немедленного реагирования
- Фильтруйте заявки по приоритету для эффективного планирования работы

---

## 10. Чеклист для новых сотрудников

1. Как создать заявку (анонимную или от зависимого)
2. Как сменить статус заявки
3. Как добавить заметку
4. Как назначить ответственного
5. Как установить приоритет
6. Как использовать шаблон
7. Как просмотреть историю статусов и логи
8. Как выполнить массовое действие
9. К кому обращаться при вопросах

---

## Важные рекомендации

1. **Всегда указывайте телефон** для контакта с заявителем
2. Используйте статусы последовательно, чтобы правильно отслеживать жизненный цикл заявки
3. Добавляйте заметки к заявкам для дополнительной информации
4. Регулярно назначайте ответственных за заявки
5. Устанавливайте приоритеты для эффективной обработки заявок

При возникновении вопросов обращайтесь к администратору системы.

## 11. Частые вопросы (FAQ)

**Q: Почему не меняется статус заявки?**
A: Проверьте, что вы выбрали корректный статус и сохранили заявку. Если статус не меняется — обновите страницу или обратитесь к администратору.

**Q: Почему не сохраняется организация?**
A: После выбора типа организации обязательно сохраните заявку, затем выберите конкретную организацию из списка и снова сохраните.

**Q: Как посмотреть историю изменений?**
A: В каждой заявке есть раздел "История статусов" и "Логи действий" — там фиксируются все изменения.

**Q: Как быстро назначить себя ответственным?**
A: Используйте массовое действие "Назначить мне" или выберите себя вручную в поле "Ответственный".

---

## 12. Таблица переходов статусов

| Текущий статус    | Возможные следующие статусы                 |
| ----------------- | ------------------------------------------- |
| Новая             | В обработке, Отменена                       |
| В обработке       | Ожидание комиссии, Лечение начато, Отменена |
| Ожидание комиссии | Комиссия получена, Отменена                 |
| Комиссия получена | Лечение начато, Отменена                    |
| Лечение начато    | Лечение завершено, Отменена                 |
| Лечение завершено | Закрыта                                     |
| Отменена          | —                                           |
| Закрыта           | —                                           |

_Вы можете пропускать этапы, если они не актуальны для конкретной заявки._
