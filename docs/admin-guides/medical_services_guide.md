# Руководство по работе с медицинскими услугами

## Обзор

Модуль медицинских услуг (`medical_services`) обеспечивает управление услугами, предоставляемыми медицинскими учреждениями. Система поддерживает категоризацию услуг, методы терапии, ценообразование и связь с учреждениями.

## Структура моделей

### 1. ServiceCategory (Категории услуг)

**Назначение**: Группировка услуг по типам (лечение алкоголизма, наркомании и т.д.)

**Ключевые поля**:

- `name` - название категории
- `slug` - URL-идентификатор (автогенерируется из названия)
- `description` - описание категории
- `parent` - родительская категория (для иерархии)
- `order` - порядок отображения
- `is_active` - активность категории

**Примеры категорий**:

- `lechenie-alkogolizma` - Лечение алкоголизма
- `lechenie-narkomanii` - Лечение наркомании
- `drugie-uslugi` - Другие услуги

### 2. TherapyMethod (Методы терапии)

**Назначение**: Справочник методов лечения

**Ключевые поля**:

- `name` - название метода
- `slug` - URL-идентификатор
- `description` - описание метода
- `is_active` - активность метода

**Примеры методов**:

- Когнитивно-поведенческая терапия
- Медикаментозная терапия
- Групповая терапия
- Семейная терапия

### 3. Service (Услуги)

**Назначение**: Конкретные медицинские услуги

**Ключевые поля**:

- `name` - название услуги
- `slug` - URL-идентификатор (автогенерируется)
- `categories` - категории услуги (M2M)
- `description` - описание услуги
- `is_active` - активность услуги

**Примеры услуг**:

- Консультация нарколога
- Детоксикация
- Кодирование от алкоголизма
- Реабилитационная программа

### 4. FacilityService (Услуги учреждений)

**Назначение**: Связь услуг с конкретными учреждениями и их цены

**Ключевые поля**:

- `facility` - учреждение (GenericForeignKey)
- `service` - услуга
- `specialists` - специалисты (M2M)
- `price` - цена услуги
- `is_active` - активность

### 5. ServicePrice (История цен)

**Назначение**: Отслеживание изменений цен на услуги

**Ключевые поля**:

- `facility_service` - услуга учреждения
- `price` - цена
- `start_date` - дата начала действия
- `end_date` - дата окончания действия

## Работа в админке

### Категории услуг

#### Добавление новой категории

1. Перейдите в **Медицинские услуги** → **Категории услуг** → **Добавить**
2. Заполните поля:
   - **Название**: Лечение алкоголизма
   - **Slug**: автоматически заполнится из названия
   - **Описание**: Краткое описание категории
   - **Родительская категория**: Оставьте пустым для корневой категории
   - **Порядок**: 1 (для первой позиции)
   - **Активна**: ✓
3. Нажмите **Сохранить**

#### Редактирование категории

1. Найдите нужную категорию в списке
2. Нажмите на название для редактирования
3. Измените необходимые поля
4. Нажмите **Сохранить**

#### Иерархия категорий

Для создания подкатегорий:

1. Создайте родительскую категорию (например, "Лечение зависимостей")
2. При создании дочерней категории выберите родительскую в поле **Родительская категория**

### Методы терапии

#### Добавление метода

1. Перейдите в **Медицинские услуги** → **Методы терапии** → **Добавить**
2. Заполните поля:
   - **Название**: Когнитивно-поведенческая терапия
   - **Slug**: автоматически заполнится
   - **Описание**: Подробное описание метода
   - **Активен**: ✓
3. Нажмите **Сохранить**

### Услуги

#### Добавление новой услуги

1. Перейдите в **Медицинские услуги** → **Услуги** → **Добавить**
2. Заполните поля:
   - **Название**: Консультация нарколога
   - **Описание**: Подробное описание услуги
   - **Категории**: Выберите нужные категории
   - **Активна**: ✓
3. Нажмите **Сохранить**

#### Назначение категорий

В поле **Категории** можно выбрать несколько категорий:

- Используйте Ctrl+клик для выбора нескольких
- Или используйте стрелки для перемещения между списками

### Услуги учреждений

#### Добавление услуги к учреждению

1. Перейдите в **Медицинские услуги** → **Услуги учреждений** → **Добавить**
2. Заполните поля:
   - **Тип учреждения**: Выберите тип (Клиника/Реабилитационный центр/Частный врач)
   - **ID учреждения**: Выберите конкретное учреждение
   - **Услуга**: Выберите услугу из списка
   - **Специалисты**: Выберите специалистов (опционально)
   - **Цена**: Укажите стоимость
   - **Активна**: ✓
3. Нажмите **Сохранить**

#### Важные моменты

- **Тип учреждения**: Поддерживаются клиники, реабилитационные центры и частные врачи
- **Уникальность**: Каждая услуга может быть добавлена к учреждению только один раз
- **Цена**: При изменении цены автоматически создается запись в истории цен

## Автоматизация

### Генерация slug

- Для `ServiceCategory` и `TherapyMethod`: slug генерируется автоматически из названия с транслитерацией
- Для `Service`: slug генерируется автоматически с проверкой уникальности

### История цен

При изменении цены в `FacilityService`:

1. Автоматически закрывается предыдущая запись в истории
2. Создается новая запись с текущей датой
3. Все изменения отслеживаются в `ServicePrice`

## Интеграция с другими модулями

### Связь с учреждениями

- `FacilityService` использует GenericForeignKey для связи с любыми учреждениями
- Поддерживаются клиники (`Clinic`), реабилитационные центры (`RehabCenter`) и частные врачи (`PrivateDoctor`)

### Связь со специалистами

- Услуги учреждений могут быть привязаны к конкретным специалистам
- Специалисты могут работать с несколькими услугами

### Использование в шаблонах

В шаблонах услуги доступны через контекст:

```python
# В представлении
service_categories = {
    'alcoholism': {
        'category': ServiceCategory.objects.get(slug='lechenie-alkogolizma'),
        'services': Service.objects.filter(categories=category, is_active=True)
    }
}

# В шаблоне
{{ service_categories.alcoholism.category.name }}
{% for service in service_categories.alcoholism.services %}
    {{ service.name }}
{% endfor %}
```

## Дизайн-система и шаблоны

### Структура страниц

Все страницы медицинских услуг используют единую дизайн-систему:

- **Хлебные крошки**: Стандартная навигация
- **Секции**: `catalog`, `section__content`, `rehabs__cards`
- **Карточки**: `card`, `card__content`, `card__title`, `card__description`
- **Теги**: `useful-info__tags`, `useful-info__tag`

### Доступные страницы

1. **Список услуг** (`/medical-services/services/`)

   - Поиск и фильтрация по категориям
   - Карточки услуг с тегами категорий
   - Пагинация

2. **Детальная страница услуги** (`/medical-services/service/<slug>/`)

   - Описание услуги
   - Категории (стилизованные теги)
   - Список учреждений, предоставляющих услугу

3. **Детальная страница категории** (`/medical-services/category/<slug>/`)
   - Услуги в категории
   - Подкатегории (если есть)
   - Карточки услуг и подкатегорий

### Навигация

- **Главное меню**: Нет прямых ссылок на услуги
- **Футер**: Ссылки на основные категории (алкоголизм, наркомания)
- **Хлебные крошки**: Навигация между страницами услуг
- **Карточки услуг**: Ссылки на теги категорий

## Рекомендации по использованию

### Организация категорий

1. **Создайте основные категории**:

   - Лечение алкоголизма
   - Лечение наркомании
   - Другие услуги

2. **Используйте порядок** для правильного отображения на сайте

3. **Активируйте только нужные** категории и услуги

### Управление ценами

1. **Регулярно обновляйте цены** через админку
2. **Используйте историю цен** для анализа изменений
3. **Проверяйте актуальность** цен в учреждениях

### Работа с услугами

1. **Создавайте подробные описания** для лучшего понимания клиентами
2. **Назначайте специалистов** для персонального подхода
3. **Используйте категории** для логичной группировки

## Частые операции

### Массовое обновление цен

1. Перейдите в **Услуги учреждений**
2. Используйте фильтры для выбора нужных учреждений
3. Выберите услуги для обновления
4. Измените цены
5. Сохраните изменения

### Деактивация услуг

1. Найдите услугу в списке
2. Снимите галочку **Активна**
3. Сохраните изменения

### Поиск услуг

Используйте поиск по:

- Названию услуги
- Описанию
- Категориям
- Учреждениям

## Устранение неполадок

### Услуга не отображается на сайте

1. Проверьте, что услуга **активна**
2. Убедитесь, что услуга привязана к **активной категории**
3. Проверьте, что услуга добавлена к **активному учреждению**

### Ошибка при создании услуги

1. Проверьте уникальность **slug**
2. Убедитесь, что выбрана хотя бы одна **категория**

### Проблемы с ценами

1. Проверьте, что цена указана корректно (число с двумя знаками после запятой)
2. Убедитесь, что цена не отрицательная
3. Проверьте историю цен для анализа изменений

## Примеры использования

### Создание полного набора услуг для клиники

1. **Создайте категории**:

   - Лечение алкоголизма
   - Лечение наркомании
   - Консультации

2. **Добавьте услуги**:

   - Консультация нарколога
   - Детоксикация
   - Кодирование

3. **Свяжите с учреждением**:
   - Добавьте услуги к клинике
   - Укажите цены
   - Назначьте специалистов

### Настройка иерархии категорий

1. **Создайте родительскую категорию**: "Лечение зависимостей"
2. **Создайте подкатегории**:
   - "Лечение алкоголизма" (родитель: "Лечение зависимостей")
   - "Лечение наркомании" (родитель: "Лечение зависимостей")

Это обеспечит логичную структуру и удобную навигацию для пользователей.

## Изменения в версии

### Последние обновления

- **Удалена страница списка категорий**: Не использовалась в навигации
- **Упрощена детальная страница услуги**: Убраны изображение, длительность и счётчик учреждений
- **Унифицирован дизайн**: Все страницы используют единую дизайн-систему
- **Улучшены карточки услуг**: Добавлены стилизованные теги категорий
- **Оптимизирована навигация**: Убраны неиспользуемые ссылки
