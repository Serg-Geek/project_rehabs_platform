@startuml
skinparam rankdir TB
title ERD - Структура базы данных "Центр помощи зависимым"
legend
  <b>Основные принципы структуры:</b>
  * Наследование от AbstractMedicalFacility для всех учреждений
  * Generic Relations для гибких связей (изображения, документы, специалисты, отзывы)
  * Единообразная работа с изображениями через main_image property
  * Модульная организация по Django-приложениям
  
  <b>Ключевые бизнес-процессы:</b>
  * Регистрация и управление учреждениями (клиники, реабилитационные центры, частные врачи)
  * Управление специалистами и специализациями
  * Обработка отзывов и рейтингов
  * Управление изображениями и документами учреждений
  
  <b>Рекомендации по индексам:</b>
  * Составной индекс (city, organization_type) для фильтрации
  * Индекс по полю slug для URL-маршрутизации
  * Индекс по is_main для быстрого поиска главных изображений
  * Индекс по content_type, object_id для Generic Relations
  
  <b>Особенности реализации:</b>
  * Мягкое удаление через поле is_active
  * Аудит изменений через TimeStampedModel
  * Гибкая система связей через Generic Relations
  * Единообразный API для всех типов учреждений
end legend

' Core приложение
note as CoreNote
  <b>Core - Базовые справочники</b>
  Основные процессы:
  * Управление регионами и городами
  * Географическая привязка учреждений
  * Поддержка многоязычности через slug
  
  Особенности:
  * Иерархия: Регион -> Город
  * Уникальные slug для SEO
  * Активность городов
end note

' Facilities приложение
note as FacilitiesNote
  <b>Facilities - Учреждения</b>
  Основные процессы:
  * Регистрация учреждений разных типов
  * Управление контактной информацией
  * Контроль лицензий и документов
  * Управление изображениями
  
  Типы учреждений:
  * Клиники (emergency_support, has_hospital)
  * Реабилитационные центры (capacity, program_duration)
  * Частные врачи (специализации, график, цены)
  
  Особенности:
  * Наследование от AbstractMedicalFacility
  * Generic Relations для гибкости
  * Единообразный API
end note

' Staff приложение
note as StaffNote
  <b>Staff - Персонал</b>
  Основные процессы:
  * Управление специалистами учреждений
  * Назначение специализаций
  * Контроль квалификации и опыта
  
  Особенности:
  * Generic Relations для привязки к учреждениям
  * Фото специалистов
  * Биографии и достижения
end note

' Reviews приложение
note as ReviewsNote
  <b>Reviews - Отзывы</b>
  Основные процессы:
  * Оставление отзывов о учреждениях
  * Рейтинговая система
  * Модерация контента
  
  Особенности:
  * Generic Relations для всех типов учреждений
  * Рейтинг от 1 до 5 звезд
  * Текстовые отзывы
end note

' Базовые модели
entity "TimeStampedModel" as TimeStampedModel {
    + id : int <<PK>>
    --
    created_at : datetime
    updated_at : datetime
}

' Core приложение
entity "Region" as Region {
    + id : int <<PK>>
    --
    name : string
    slug : string
    created_at : datetime
    updated_at : datetime
}

entity "City" as City {
    + id : int <<PK>>
    --
    name : string
    slug : string
    region : Region <<FK>>
    created_at : datetime
    updated_at : datetime
}

' Facilities приложение
entity "OrganizationType" as OrganizationType {
    + id : int <<PK>>
    --
    name : string
    slug : string
    description : text
    competencies : text
    created_at : datetime
    updated_at : datetime
}

entity "AbstractMedicalFacility" as AbstractMedicalFacility {
    + id : int <<PK>>
    --
    name : string
    slug : string
    organization_type : OrganizationType <<FK>>
    description : text
    address : text
    phone : string
    email : string
    website : string
    license_number : string
    is_active : bool
    city : City <<FK>>
    created_at : datetime
    updated_at : datetime
}

entity "RehabCenter" as RehabCenter {
    + id : int <<PK>>
    --
    capacity : int
    program_duration : int
    min_price : decimal
    accommodation_conditions : text
}

entity "Clinic" as Clinic {
    + id : int <<PK>>
    --
    emergency_support : bool
    has_hospital : bool
}

entity "PrivateDoctor" as PrivateDoctor {
    + id : int <<PK>>
    --
    first_name : string
    last_name : string
    middle_name : string
    experience_years : int
    education : text
    biography : text
    achievements : text
    office_description : text
    parking_available : bool
    wheelchair_accessible : bool
    schedule : text
    home_visits : bool
    emergency_available : bool
    weekend_work : bool
    consultation_price : decimal
    home_visit_price : decimal
    insurance_accepted : bool
    license_issue_date : date
    license_expiry_date : date
    online_consultations : bool
    video_consultations : bool
    special_equipment : text
}

entity "FacilityImage" as FacilityImage {
    + id : int <<PK>>
    --
    content_type : ContentType <<FK>>
    object_id : int
    image : ImageField
    image_type : string
    title : string
    description : text
    is_main : bool
    order : int
    created_at : datetime
    updated_at : datetime
}

entity "FacilityDocument" as FacilityDocument {
    + id : int <<PK>>
    --
    content_type : ContentType <<FK>>
    object_id : int
    document_type : string
    title : string
    document : FileField
    number : string
    issue_date : date
    expiry_date : date
    is_active : bool
    created_at : datetime
    updated_at : datetime
}

' Staff приложение
entity "Specialization" as Specialization {
    + id : int <<PK>>
    --
    name : string
    slug : string
    description : text
    created_at : datetime
    updated_at : datetime
}

entity "FacilitySpecialist" as FacilitySpecialist {
    + id : int <<PK>>
    --
    content_type : ContentType <<FK>>
    object_id : int
    first_name : string
    last_name : string
    middle_name : string
    photo : ImageField
    experience_years : int
    education : text
    biography : text
    achievements : text
    is_active : bool
    created_at : datetime
    updated_at : datetime
}

' Reviews приложение
entity "Review" as Review {
    + id : int <<PK>>
    --
    content_type : ContentType <<FK>>
    object_id : int
    rating : int
    content : text
    created_at : datetime
    updated_at : datetime
}

' Связи наследования
AbstractMedicalFacility --|> TimeStampedModel
RehabCenter --|> AbstractMedicalFacility
Clinic --|> AbstractMedicalFacility
PrivateDoctor --|> AbstractMedicalFacility

' Связи Many-to-Many
PrivateDoctor ||--o{ Specialization : "specializations"

' Generic Relations (через content_type и object_id)
RehabCenter ||--o{ FacilityImage : "images"
Clinic ||--o{ FacilityImage : "images"
PrivateDoctor ||--o{ FacilityImage : "images"

RehabCenter ||--o{ FacilityDocument : "documents"
Clinic ||--o{ FacilityDocument : "documents"
PrivateDoctor ||--o{ FacilityDocument : "documents"

RehabCenter ||--o{ FacilitySpecialist : "specialists"
Clinic ||--o{ FacilitySpecialist : "specialists"
PrivateDoctor ||--o{ FacilitySpecialist : "specialists"

RehabCenter ||--o{ Review : "reviews"
Clinic ||--o{ Review : "reviews"
PrivateDoctor ||--o{ Review : "reviews"

' Связи Foreign Key
City ||--o{ AbstractMedicalFacility : "city"
OrganizationType ||--o{ AbstractMedicalFacility : "organization_type"
City ||--o{ Region : "region"

@enduml 