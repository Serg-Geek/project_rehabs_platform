@startuml
!theme plain

title Диаграмма состояний - Жизненный цикл отзыва

[*] --> Draft : Пользователь создает отзыв

state Draft {
    [Черновик] as DraftState
    [Заполнение формы] as FormFilling
    [Валидация данных] as Validation
    
    DraftState --> FormFilling
    FormFilling --> Validation
    Validation --> DraftState : Ошибки валидации
}

Draft --> Pending : Отправка на модерацию

state Pending {
    [Ожидает модерации] as PendingState
    [В очереди] as InQueue
    [Назначен модератор] as Assigned
    
    PendingState --> InQueue
    InQueue --> Assigned
}

Pending --> UnderReview : Модератор начинает проверку

state UnderReview {
    [На проверке] as ReviewState
    [Проверка содержания] as ContentCheck
    [Проверка рейтинга] as RatingCheck
    [Проверка на спам] as SpamCheck
    
    ReviewState --> ContentCheck
    ContentCheck --> RatingCheck
    RatingCheck --> SpamCheck
}

UnderReview --> Approved : Модератор одобряет
UnderReview --> Rejected : Модератор отклоняет
UnderReview --> NeedsRevision : Требует доработки

state NeedsRevision {
    [Требует доработки] as RevisionState
    [Отправлено автору] as SentToAuthor
    [Ожидает исправлений] as WaitingForFix
    
    RevisionState --> SentToAuthor
    SentToAuthor --> WaitingForFix
}

NeedsRevision --> Draft : Автор исправляет
NeedsRevision --> Rejected : Автор не исправляет

state Approved {
    [Одобрен] as ApprovedState
    [Опубликован] as Published
    [Виден пользователям] as Visible
    
    ApprovedState --> Published
    Published --> Visible
}

state Rejected {
    [Отклонен] as RejectedState
    [Причина отклонения] as RejectionReason
    [Уведомление автору] as AuthorNotification
    
    RejectedState --> RejectionReason
    RejectionReason --> AuthorNotification
}

Approved --> Archived : Время истекло
Rejected --> [*] : Удаление

state Archived {
    [Архивирован] as ArchivedState
    [Неактивен] as Inactive
    [Может быть восстановлен] as Restorable
    
    ArchivedState --> Inactive
    Inactive --> Restorable
}

Archived --> Approved : Восстановление администратором
Archived --> [*] : Окончательное удаление

note right of Draft
  В состоянии черновика:
  - Пользователь может редактировать
  - Автосохранение
  - Предварительный просмотр
end note

note right of Pending
  В очереди модерации:
  - Приоритет по времени
  - Автоматическое уведомление
  - Назначение модератора
end note

note right of UnderReview
  При проверке:
  - Проверка на соответствие правилам
  - Проверка рейтинга на адекватность
  - Анализ на спам/боты
end note

note right of Approved
  После одобрения:
  - Публикация на сайте
  - Уведомление учреждения
  - Обновление рейтинга
end note

@enduml 