# Критика проекта Rehabs Platform

## 1. Архитектура и структура

**Плюсы:**

- Проект разбит на отдельные Django-приложения по предметным областям (facilities, staff, users, blog, requests и др.).
- Используется абстрактная модель для медицинских учреждений (AbstractMedicalFacility).
- Есть документация по архитектуре, ERD/UML-диаграммы, техническое задание.

**Минусы и замечания:**

- **Слабая модульность бизнес-логики:** часть логики вынесена в сервисы, но не всегда соблюдается принцип "тонких" представлений (CBV иногда перегружены).
- **Дублирование кода:** встречается в обработке ошибок и валидации (например, в CBV для заявок — много похожих try/except и ручной разбор ошибок формы).
- **Много неиспользуемых/устаревших полей:** по анализу (см. docs/development/unused_fields_analysis.md) — в моделях много полей, которые не используются в шаблонах, а иногда и в коде. Это усложняет поддержку и миграции.
- **SEO-поля не используются:** поля meta_title/meta_description есть, но не интегрированы в шаблоны — теряется потенциал для SEO.
- **Часть полей используется только в админке или печатных отчетах:** это допустимо, но требует явной документации и комментариев в моделях.

---

## 2. Качество кода и стандарты

**Плюсы:**

- Используется PEP8, black, flake8.
- Есть .pylintrc, но...

**Минусы и замечания:**

- **.pylintrc чрезмерно ослаблен:** отключены важные проверки (docstring, line-too-long, trailing-whitespace, no-member и др.), что снижает качество кода и усложняет ревью.
- **Докстринги часто отсутствуют:** из-за отключения проверки — код хуже читается и поддерживается.
- **В некоторых местах не соблюдается DRY:** например, ручная обработка ошибок в нескольких CBV, дублирующиеся методы логирования IP и т.д.
- **Валидация дублируется:** часть в ModelForm, часть в сервисах, часть в представлениях — нет единого центра.

---

## 3. Работа с ошибками и логированием

**Плюсы:**

- Реализовано кастомное middleware для логирования, безопасности, производительности.
- Логируются ошибки, подозрительная активность, медленные запросы.

**Минусы и замечания:**

- **Логика логирования частично дублируется:** методы получения IP, логика обработки исключений.
- **Обработка ошибок в CBV не всегда централизована:** много ручного try/except, что затрудняет поддержку.
- **Нет единого подхода к пользовательским сообщениям об ошибках:** где-то JsonResponse, где-то messages, где-то редиректы с ошибкой.

---

## 4. Тестирование

**Плюсы:**

- Есть руководство по тестированию, структура тестов по приложениям, используются unittest и pytest.
- Описаны рекомендации по написанию тестов.

**Минусы и замечания:**

- **Нет информации о покрытии кода тестами:** неясно, насколько покрыты бизнес-критичные сценарии.
- **Нет автоматической проверки покрытия в CI/CD:** не упоминается интеграция с coverage/pytest-cov.
- **Тесты не всегда обязательны для новых фич:** нет enforce-политики (например, через pre-commit hook).

---

## 5. Зависимости и безопасность

**Плюсы:**

- Используются только необходимые библиотеки, большинство — актуальные.

**Минусы и замечания:**

- **Нет проверки на уязвимости зависимостей:** не интегрирован safety/pip-audit.
- **Нет явного requirements-dev.txt:** dev-зависимости (pytest, coverage и др.) не отделены от production.

---

## 6. Документация

**Плюсы:**

- Много документации: архитектура, ТЗ, гайды для админов и разработчиков.

**Минусы и замечания:**

- **Документация не всегда актуальна:** часть рекомендаций по оптимизации и рефакторингу не реализована (см. unused_fields_analysis.md).
- **Нет единого entry-point для новых разработчиков:** приходится искать по разным файлам.

---

# План улучшений

1. **Рефакторинг моделей:**

   - Удалить реально неиспользуемые поля.
   - Добавить комментарии к полям, используемым только в админке/отчетах.
   - Интегрировать SEO-поля в шаблоны.

2. **Ужесточить линтинг:**

   - Включить docstring, trailing whitespace, line-too-long и др. в .pylintrc.
   - Ввести pre-commit hook на black/flake8/pylint.

3. **Централизовать обработку ошибок:**

   - Вынести обработку ошибок и формирование сообщений в отдельный модуль/миксин.
   - Минимизировать try/except в CBV.

4. **Оптимизировать тестирование:**

   - Ввести обязательное покрытие тестами новых фич (enforce через CI).
   - Добавить requirements-dev.txt.
   - Интегрировать pytest-cov и отчеты о покрытии.

5. **Документация:**

   - Обновить и унифицировать документацию.
   - Добавить entry-point для новых разработчиков.

6. **Безопасность и зависимости:**
   - Интегрировать pip-audit/safety.
   - Разделить prod/dev зависимости.
